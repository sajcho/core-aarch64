# Description:	Directory content manager
# URL:		http://www.kernel.org/pub/software/scm/git/docs
# Maintainer:	Thomas Penteker, tek at serverop dot de
# Packager:	Tilman Sauerbeck, tilman at crux dot nu
# Depends on:	expat curl python
# Modified:	Milan Buska, milan dot buska at gmail dot com

name=git
version=2.27.0
release=1
source=(https://www.kernel.org/pub/software/scm/git/git-{,manpages-}$version.tar.xz
	git gitd.conf gitd.run)

build() {
	cd $name-$version

	make \
		CFLAGS="$CFLAGS" \
		prefix=/usr \
		gitexecdir=/usr/lib/git-core \
		INSTALLSITEMAN3DIR=/usr/share/man/man3 \
		perllibdir=/usr/lib/perl5/site_perl/5.30 \
		DESTDIR=$PKG install

	cd $SRC
	for i in man*; do
		install -d $PKG/usr/share/man/$i
		install -m 644 $i/* $PKG/usr/share/man/$i;
	done

	find $PKG \( -name perllocal.pod -o -name .packlist \) -delete
	rm -rf $PKG/usr/share/{locale,gitk}

	# install the git ports driver
	install -d $PKG/etc/ports/drivers
	install -m 0755 $SRC/git $PKG/etc/ports/drivers/git

	# gitd runit service
	install -d $PKG/etc/sv/gitd
	install -m 0644 $SRC/gitd.conf $PKG/etc/sv/gitd/conf
	install -m 0755 $SRC/gitd.run $PKG/etc/sv/gitd/run
	ln -s /run/runit/supervise.gitd $PKG/etc/sv/gitd/supervise
}
