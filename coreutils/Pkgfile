# Description:	A collection of core GNU utilities
# URL:		http://www.gnu.org/software/coreutils/
# Maintainer:	sajcho, saux dot aarch64 at gmail dot com
# Depends on:	gmp acl libcap

name=coreutils
version=9.0
release=1
source=(http://ftpmirror.gnu.org/gnu/${name}/${name}-${version}.tar.xz \
	${name}-8.2-uname-processortype.patch \
	${name}-9.0-chmod-symlink.patch \
	${name}-i18n.patch)

build() {
	cd ${name}-${version}

	# do display processor type for uname -p/-i based on uname(2) syscall
	patch -p1 -i $SRC/${name}-8.2-uname-processortype.patch
	# chmod: fix exit status when ignoring symlinks
	patch -p1 -i $SRC/${name}-9.0-chmod-symlink.patch
	# (sb) lin18nux/lsb compliance - multibyte functionality patch
	patch -p1 -i $SRC/${name}-i18n.patch

	autoreconf -fiv

	export FORCE_UNSAFE_CONFIGURE=1

	./configure \
		--prefix=/usr \
		--libexecdir=/usr/lib \
		--disable-nls \
		--disable-assert \
		--enable-no-install-program=uptime,kill,chcon,runcon,groups

	make V=1

	make DESTDIR=$PKG install

	install -d $PKG/bin
	# these binaries move from /usr/bin to /bin
	local binaries="cat chgrp chmod chown cp date dd df echo false ln ls mkdir \
		sleep mknod mv pwd readlink rm rmdir stty sync touch true uname"
	for f in $binaries; do \
		mv $PKG/usr/bin/$f $PKG/bin; \
	done

	rm -r $PKG/usr/share/info
}
